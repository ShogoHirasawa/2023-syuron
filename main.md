# 洪水災害時における避難支援のためのオフライン 3D ハザードマップの開発と評価

## 概要

本研究では洪水被害発生時に通信インフラがダウンした状況でも、スマートフォンを媒介としたデジタルハザードマップを通じて、危険地帯を把握するシステムの可能性について検討する。スマートフォンをインターフェイスとしたオフライン環境下で利用できる地図サービスとして、「Google Maps」、「Maps.me」、「あかりマップ」のような事例はみられるものの、App Store や Google Play といったアプリストアからの事前ダウンロードなしにオフラインで活用できる地図サービスおよび、ハザードマップサービスの事例は見られない。そこで、Raspberry Pi 4 を基調とした持ち運び可能な地図配信サーバー及び、ハザードマップに最適化させた地図データ、ハザードマップデザインの開発を行い、事前ダウンロードなしに通信インフラがダウンした状況でブラウザ経由でハザードマップにアクセスし、利用者が洪水災害時において危険地帯を把握できるかを検討する。この実装例を通じて、オフライン環境下でも地図情報にアクセスし、利用者が適切な避難ルートを検討する支援を行うことを可能とする。

### 1.はじめに（書き途中）

近年、自然災害が多発するなかで、市民の避難を適切にかつ安全に実施することは極めて重要な点である。特に洪水災害においては、2005 年の水防法改正により浸水想定区域の指定を受けた市町村は市民に対して、洪水予測の公表が義務付けられた。また、2005 年から 2009 年に洪水ハザードマップ作成に対する国庫補助制度が策定されたことを契機にハザードマップの普及は進んだ（榎村,2012）。各自治体の Web ページにおいて pdf データでの提供や自治体が主導となり各世帯への紙のハザードマップの配布のみならず、国土地理院が国土交通省水管理・国土保全局と協力して提供する「国土交通省ハザードマップポータルサイト」をはじめとした Web 上でインタラクティブに災害情報を伝えるハザードマップも存在する（泉谷,2020）。Web 媒体でハザードマップの閲覧が可能がになることで、各レイヤ情報の表示・非表示が可能となり、多くの情報を盛り込んでもインターフェイスが雑多で見づらくならない、ピンチイン・アウトが可能となり詳細な地図情報を表示できるようになるなど、pdf、紙媒体でのハザードマップの表現の限界を克服している。（論文の構成を簡単に書くこと）本稿では第二章で〜

## 2. 関連研究・関連事例

本章では、洪水災害時におけるオフライン環境について、オフライン環境下でのハザードマップに関する既往研究・先行事例を示し、本研究の位置づけを明らかにする。

### 1.1.1 洪水災害発生時のインターネット障害

一方で、洪水被害が発生した際にはインターネットが断絶する事例が報告されている。2020 年 7 月 4 日大雨の影響により熊本県球磨川が氾濫するなどして、死者・行方不明者が 69 人がでる被害が発生した（NHK,2023）。この大雨の影響により、停電、土砂崩れ等による回線が断絶し、22 市町村でインターネットの接続が困難となった（総務省,2020）。また、回線が断絶するといった直接的な被害のみならず、大雨や洪水によって交通インフラが損傷し、インターネットサービスプロバイダー等の通信に関わる事業者の業務が中断されることで、インターネットサービスの提供に支障をきたすことを指摘する研究報告も上がっている（Fekete and Alexander,2019）。加えて、災害時には通信が輻輳し、インターネットに接続が難しくなる状況も発生する（増田,2012）。オフライン環境下では、従来の紙媒体での洪水ハザードマップの利用が想定されるが、避難所や浸水域等の情報を 1 枚の紙に集約しなくてはいけない都合上、インターフェイスが雑多になってしまうことや、配布されて時間が経過することによってハザードマップを紛失してしまう住民が存在するなどの課題がある（方田他,1999）（榎村,2012） 。洪水ハザードマップの役割の一つに発災時において市民が避難をする際のマニュアルとして機能することが挙げられる（片田他,2004）。「Google Maps」や「Maps．me」等のオフライン環境下であっても、スマートフォンで地図を閲覧できる機能を有したサービスはあるが、浸水深や浸水域の情報、避難所の位置情報、標高情報といった情報は有していないため、避難ルートを検討することが難しい。

### 1.2. 研究の目的

以上の背景を踏まえ、本研究の目的は洪水被害発生時に通信インフラがダウンした状況でも、スマートフォンのブラウザアプリケーションを通じて避難ルートを検討するための情報が掲載された洪水ハザードマップを閲覧可能とするシステムの提案することである。

## 2. 先行事例・既往研究

### 2.1. 洪水被害地域における通信インフラ環境

洪水災害発生時において、洪水被害の影響によりインターネットに接続することが難しい状況が発生する。本節では洪水被害環境下におけるインターネット接続に関して、どのような事例が発生したのか、また既往研究についてを明らかにする。
2020 年 7 月 4 日に熊本県に豪雨が発生し、死者・行方不明者が 69 人がでる甚大な洪水被害が起きた。本豪雨の影響により氾濫流と呼ばれる、家屋をも流してしまう大きい威力の流れが発生するなど、氾濫地域に多くの影響を及ぼした。この豪雨の影響は住居等のインフラを破壊したのみならず、通信インフラにも影響を及ぼしたことが報告された。総務省からの通信に関した被害状況報告によると、2020 年 7 月 4 日の豪雨による停電、土砂崩れ等によって、被災地域の携帯電話基地局が停波した。最大影響時には NTT ドコモ社で 22 市町村、KDDI（au）社で 15 市町村、ソフトバンク社で 23 市町村で電波障害が発生した（2020,総務省）。NTT 西日本がリリースした本洪水被害における通信サービスの影響を記した報告書によると、インターネットサービス 100 回線でインターネット障害が発生したことが報告された（2020,NTT 西日本）。上記の通り熊本豪雨では甚大なインターネット障害が発生し、オフライン環境が発生した。洪水発生時には停電、土砂崩れ等の影響のみならず、これらの 2 次的な影響によってインターネットが断絶または、復旧が長期化する懸念もある。甚大な洪水被害によって、交通インフラ等が機能が停止し、電力や通信インフラの従事者が通常業務を行うためやインフラ復旧のために現場に駆けつけることが難しくなり、定常業務および復旧作業を行うことが難しくなる状況が発生する（2019,Fekete）。このように、洪水被害は直接的または間接的に、インターネットインフラに影響を及ぼす場合がある。近年、地図を閲覧する媒体は紙からデジタルへと変遷してきた。日常生活における地図利用において、紙地図の利用は減少傾向にあり、一方でデジタル地図の利用は増加している（2018,株式会社ゼンリン）。また、紙媒体でのハザードマップは紛失しやいことも看過できない問題である（2014,関西大学 社会安全学部）。今後、紙地図の普及が増加する見込みは低い中で、洪水災害時のオフライン環境でのハザードマップへのアクセス手法を確立することは急務であるといえる。

### 2.2 オフラインで利用可能な地図サービス

インターネットが断絶した際に、紙媒体でのハザードマップはオフライン環境下で利用できる地図ツールとして有効である。ただ紙媒体であるがゆえに広い範囲をカバーしようとすると、紙のサイズを大きくする必要があり、携帯することが難しくなる。実際に自治体が配布するハザードマップのなかには、サイズが大きいため携帯するには不便なものも存在する（2012,榎村）。ハザードマップは災害時において避難のマニュアルとして活用される。故に、避難の際に持ち運びが難しい形態であることは、本来の目的を推敲できない。2.1 で述べた通り、紙地図の利用は減少していくことが想定されていることから、オフライン環境であってもスマートフォン等でデジタル地図を利用させることは不可欠である。このような背景から本節では、既存のオフライン地図についての動向をまとめる。
2005 年にサービスが開始された Google Maps は 2022 年には全世界におけるダウンロード数が 10 億件を超え、現代社会において最も使われている地図サービスである（2022,日経新聞）。Google Maps は Web ブラウザ、スマートフォン、タブレットに対応しており、インターネット接続を通じて地図を閲覧することができる。一方で、Google Maps はオフライン環境下でも地図サービスの利用を可能としている。インターネット接続が遅い、利用できない環境を考慮して予め任意のエリアを端末に保存し、オフラインで使用することができる（2023,Google）。オフライン環境であっても事前に利用したいエリアを保存しておくことで、ルート検索、ナビゲーション機能、地名検索も行える。ただしオフライン状態であると、公共交通機関、自転車、徒歩の経路を表示することはできない。Google Maps はオフライン機能を有しているが、あくまでもサブ機能であり通常はインターネット通信を基本とした利用が想定されている。オフラインでの機能に特化したデジタルマップの点でいうと最も有名なサービスの一つとして MAPS.ME が挙げられる。MAPS.ME は契約する通信キャリアが利用できない地域に旅行する人々をターゲットに利用されており、執筆時点で 1 億 4,000 万ダウンロードを達成している（2024,MAPS.ME）。Google Maps と同様に事前に任意のエリアをダウンロードすることで、オフライン環境下での利用が可能となる。MAPS.ME でも同様にルート検索、ナビゲーション機能、地名検索が行える。加えて、MAPS.ME ではオフライン環境下で自動車、徒歩、自転車に合わせたナビゲーションが行える。
Google Maps と MAPS.ME ともにインターネット接続が困難な状態であっても、地図の提供が行えるシステムとなっている。これらのサービスはルート検索、ナビゲーション機能、地名検索が行える一方で、洪水災害の避難の際に必要となる浸水域の表示や避難所の表示は行えていない。日常的な利用や旅行先での利用を想定しているため、洪水災害のシチュエーションには対応しているとは言い難い。洪水災害発生時においては、浸水域、斜度のある地域、標高が低い地域等の把握が重要となる（2021,日本気象協会）。激甚災害発生時に必要となる情報が盛り込まれておりかつ、オフライン状態で利用できる地図システム及び地図サービスは現時点で数多くない。これを踏まえ次の節では、オフライン環境でかつ災害時の避難に必要となる地図の提供に対して取り組む既往研究について述べる。

### 2.3. オフライン Web ハザードマップの先行研究（書き途中）

2.2 で論じた通り、洪水災害時のインターネット接続が困難な場合においてデジタルなハザードマップへのアクセスを確立することは急務である。本節では災害時のオフライン環境下におけるハザードマップ及びオフライン地図の先行研究を列挙するともに、既往研究における課題を整理する。災害時のオフライン環境でのハザードマップ利用を可能とするものとして、オフライン対応型災害時避難支援システム「あかりマップ」が挙げられる（2017,吉野孝 et al）。「あかりマップ」は災害時のオフライン環境での稼働に特化した災害時避難支援システムである。このシステムは Android のスマートフォン端末でのみ利用することができ、災害が発生する前に、ユーザーが自身の端末に地図情報、避難支援情報をダウンロードすることを想定している。事前にダウンロードされた情報は、災害が発生し通信網が利用不可能になった場合でも、ユーザーが端末上でアクセスできるようになっている。端末上で表示される情報には、浸水域、避難所の位置、AED（自動体外式除細動器）の設置場所、コンビニエンスストアの場所、自動販売機の設置場所が含まれ、これらの情報はオフライン状態でも参照可能となっている。また、利用者にデバイスの電池残量を意識させるために、画面上部に電池残量を示すバーが設置されている。「あかりマップ」はオフラインで稼働できる設計になっている一方で、洪水ハザードマップとして活用するには 3 つの課題が存在している。1 つ目は特定 OS に依存している点である。「あかりマップ」は Android を搭載したスマートフォンのみで利用することができ、他の OS での利用が不可能な設計になっている。2 店目はユーザーによる事前のダウンロードが必要な点である。2.1 で述べた通り、洪水被害発生時にはインターネットに接続することが難しい場合が生じる。ユーザーが地図情報、避難支援情報を事前にダウンロードしていない場合、「あかりまっぷ」を利用することができない。3 つ目は標高に関する情報が地図上で確認できないことである。「あかりマップ」はベースマップとして

### 2.4. 洪水ハザードマップにおける標高表記について

## 3. 提案手法

### 3.1. リサーチクエッション

ここにリサーチクエッションを盛り込む

### 3.2 システム設計について

#### 3.1.1. オフライン環境下での稼働について

本節ではどのように、オフライン環境下でのハザードマップを配信するシステムを構築したかについて述べる。本研究では、低コストでありながら高い汎用性と拡張性を持つマイクロコンピューターである Raspberry Pi4（以下、ラズベリーパイ）を用いた地図サーバーの構築を試みた。ラズベリーパイは、教育や研究、趣味のプロジェクトなど、多岐にわたる分野で使用されているマイクロコンピューターである。ラズベリーパイは、そのコンパクトなサイズにも関わらず、高性能の処理能力を有している。ラズベリーパイをアクセスポイントとして機能させることにより、ラズベリーパイを基点としてイントラネットを構築し、オフライン環境下でもスマートフォンを通じてアクセス可能な地図サーバーとしての役割を果たすよう設定した。アクセスポイントとは、ワイヤレスネットワークにおけるデバイス間の通信を仲介する装置であり、この場合ではラズベリーパイがその機能を担う。これにより、オフライン状態であっても、スマートフォンやタブレットなどのデバイスから地図情報にアクセスできる体制を構築した。システムのホスティングにあたり、Apache2、hostapd、dnsmasq と呼ばれる三つのオープンソースソフトウェアパッケージを採用した。Apache2 は世界で最も普及している Web サーバーソフトウェアの一つであり、ユーザーリクエストに応じて Web ページや画像、その他のデータを配信する機能をラズベリーパイに提供する。hostapd は無線 LAN デバイスをアクセスポイントとして機能させるためのソフトウェアであり、この研究ではラズベリーパイに接続されるスマートフォン等の各デバイスの管理を担う。dnsmasq は、ネットワーク上のデバイスに対して DNS サーバーの役割を果たし、動的に IP アドレスを割り当てる機能を提供する。これらのパッケージを組み合わせることで、ラズベリーパイは単なる Web サーバーを超え、総合的な通信ソリューションとして機能し、結果として災害時においても避難者のスマートフォンを通じて地図データを提供することが可能になった。避難者はラズベリーパイに付随している QR コードをスマートフォンのカメラでスキャンすることによって、ラズベリーパイと接続し、ハザードマップの閲覧が可能となる。

#### 3.1.2. 紙地図との違いについて

本節では、従来の紙地図に基づいたハザードマップの限界点を指摘し、提案システムがこれらの問題をどのように解決するかについて詳述する。多くの自治体において、ハザードマップは A4 サイズの紙媒体で配布されることが一般的であり、市区町村全体をこのサイズの紙に収める必要がある。広い地域を一枚の紙に収めることで、道路名や地物の名称といった細部の情報を省略せざる負えなくなる。さらに、紙地図ではレイヤーという概念が存在しないため、一枚の地図に複数の情報を盛り込む必要がでてくる。これには浸水域、浸水速度、標高、避難ルート、避難所の位置など、多岐にわたる情報が含まれる。地名や山の名前といった追加情報を含めると、インターフェースが複雑になり、利用者にとっては情報過多となりがちである。また、災害発生時に雨が降っていた場合に紙地図であると濡れて利用が難しくなる場合も想定される。一方で、本研究で開発した Web ベースの地図システムでは、デジタルの利点を活かしピンチイン・ピンチアウト操作によるズームが可能である。これにより、広域の表示と同時に詳細情報の表示が可能となり、従来のハザードマップが抱える問題を克服している。また、オープンソースの地図ライブラリである MapLibre GL JS を用いることで、異なる種類の情報をレイヤーとして重ね合わせ、表示・非表示をユーザーが容易に切り替えることができる。これにより、浸水域、避難ルート、避難所といった重要な情報を、視認性を損なうことなく、明瞭に表示することが可能となり、さらには凡例も表示可能である。インターフェースの混雑を避けるために、表示・非表示の切り替えは単なるクリックまたはタップ操作で行えるように実装した。また、2023 年時点での主要な Apple、Samsung、Huawei といったスマートフォンブランドの多くのモデルは、IP67 または IP68 の防水等級を有している。これは、一定の深さ（通常は 1 メートルから 1.5 メートル）の水中に 30 分間程度浸しても機能するレベルの防水性能を有していることを意味している。本システムはスマートフォンからのアクセスを前提としているため、紙地図よりも防水体制が高い状態で、ハザードマップを閲覧することが可能となる。本システムはデジタル地図の利点を生かし、紙地図に固有の制限を克服し、情報の過不足のトレードオフを解決することに成功している。

#### 3.1.3. ベンダーロックインの回避

本節では、オフライン Web 地図サービスにおけるベンダーロックインの問題に深く掘り下げる。ベンダーロックインは、消費者やユーザーが特定のベンダーの技術やサービスに縛られ、他の代替品への移行が技術的、経済的な理由により困難になる現象のことを指す。この問題は、特に災害時のような緊急事態において、地理情報のアクセシビリティという点で重大な障害となり得る。例えば、洪水や地震などの自然災害が発生した際には、インターネットの基盤が脆弱となり、オフラインでの情報アクセスが求められる。 従来のオフライン対応の Web 地図サービスは、特定のプラットフォームやデバイスに限定されることが多く、これがベンダーロックインを助長する要因となっていた。例えば、iOS 用に設計されたアプリケーションは Android デバイスでは使用できず、その逆もまた然りである。このような状況は、ユーザーが災害時に必要な情報にアクセスする能力を制限し、その結果として安全性が低下することに繋がりかねない。この問題に対処するために、本研究ではプラットフォームに依存しない解決策を模索している。具体的には、スマートフォンやタブレットなどのデバイスに内蔵されたカメラを利用して QR コードを読み取り、これによって特定の Web 地図サービスに直接アクセスする方法を採用した。このアプローチは、Firefox、Chrome、Safari といった主要なウェブブラウザに対応しており、ユーザーがどのような OS を使用していても、どのようなスマートフォンを持っていても、同様のアクセス体験を提供する。これにより、災害時においても地図情報へのアクセスを保証し、オフラインでの情報共有を可能にする。さらに、ベンダーロックインの問題に対する実用的な回避策として機能し、災害リスク管理における地図サービスの利用を一層促進することが期待される。このように、ベンダーロックインを回避することは、技術の選択肢を広げるだけでなく、災害時の対応力を高めることにも繋げることができる。

#### 3.1.5. 標高情報の可視化

本研究では MapLibre GL JS を用いた標高情報の 3D 表示を行った。標高情報は洪水被害発生時、地形の標高や傾斜が安全な避難行動に直接関連するため、これらの情報を直感的かつ明瞭に伝える方法の開発が求められている。従来のハザードマップでは、標高情報が等高線等によって表現されることが多いが、この表現方法は一般市民にとって理解しづらいという課題があった。特に、地図上での低地と高地、急傾斜地を直感的に識別することは困難であり、実際の避難行動において適切な情報提供がなされていない問題点がある。本研究では、ウェブベースの地図サーバーに 3D 地図機能を導入し、標高や傾斜の情報を視覚的に捉えやすい形で表現することにより、ユーザーが低地や高地、傾斜地を容易に識別できるようなインターフェイスを開発した。3D 表示により、等高線だけでは把握しづらい地形の起伏や傾斜度を、ユーザーが直感的に理解できるようになる。従来の 2D 地図による表示では実現できなかった、地形の微細な変化を視覚的に捉えることが可能となった。実験当初はヒルシェード（陰影起伏図）機能を利用した高度情報の表示を行っていた。ヒルシェードは、太陽の位置を仮定し、地形による陰影を表現することで起伏を視覚化する手法である。しかし、実証実験および指導教員のフィードバックから地図を日常的に利用しないユーザーにとって理解しづらいということがわかった。このフィードバックを基に、より直感的な理解を促進するため 3D 機能へと移行した。国土地理院が提供する高精度な標高データを利用することで、3D 地図上での地形表現は一層鮮明で正確なものとなり、ユーザーが現実の地形に即した情報を得られるようになった。これにより、日常的に 2D 地図を使用することがない人々であっても、3D 地図を通じて直感的に地形を把握できるようになった。

#### 3.1.6. ベースマップの配色

本研究では、ハザードマップにおける情報の視認性を高めるために、ベースマップの配色について検討を重ねた。具体的には、モノクロを基調とした配色スキームを採用し、その効果を評価した。モノクロとは、文字通り「一色」を意味し、この文脈では黒、白、灰色のみを使用する配色方法である。モノクロ配色は、視覚的なノイズを減少させ、必要な情報のみを際立たせる。当初はオープンストリートマップ（OpenStreetMap, OSM）における標準的な地図スタイルを使用したハザードマップを構築していたが、重要な情報とそうでない情報との区別が困難であったという実際のユーザーフィードバックがあった。オープンストリートマップは、世界中の地図データを提供する無料のウェブサービスであり、その柔軟性と拡張性から広く利用されているが、デフォルトのスタイルは多様な情報を網羅しているため、特定の用途には適さないことがある。そこで本研究では、ハザードマップの利便性を向上させるために、ベースマップの配色をモノクロに刷新し、避難所の情報や浸水域、浸水深度の情報といった、避難の際に重要となる情報をより際立たせることができるようにした。

#### 3.1.7. ポップアップ表示による避難時注意点の訴求

ハザードマップの役割の一つに、避難時に適切な避難行動を促すことが挙げられる。避難時に留意すべき点や避難ルートについての知識は、防災訓練を受けることによって身につけることが一般的である。しかし、防災訓練を体験してから時間が経過することで、避難時に関する知識は忘却されることは先行研究により指摘されている。このことから、ハザードマップは避難に関する知識が無いまたは乏しい人でも、災害時における危険地帯や避難行動を促す必要がある。文京区が公開している洪水ハザードマップでは、これらの情報がハザードマップの上部に表示されていた。掲載されている文章には、表示している浸水域と浸水深の説明のみされており、避難時に避けるべき箇所の警告がなされていない。これを踏まえ本研究では、国土交通省と気象庁が発信している洪水時の危険地帯をもとに、低地と傾斜地を危険地と定義し、その警告文を以下の図のように掲示した。警告文はタップすることで表示・非表示を切り替えられるように設定した。

## 4. 実験・検証

（ここで検証デザインについて説明）

### 4.1. オフライン環境の構築

### 4.2. 接続試験

       #### 4.2.1. 通信速度テスト
       ページがレンダリングされるまでの速度、通信量の測定を行い、閾値値を満たすものかの検証

       #### 4.2.2. 消費電力の調査

ラズパイにスマホを接続した状態で、どの程度の消費電力かを定量的に計算し、稼働可能時間を推定する。

### 4.3. 避難ルートに関するユーザビリティ評価

       #### 4.3.1. 検証方法の説明
       #### 4.3.2 被験者の属性
       #### 4.3.2. 調査結果

## 5. 結論

### 5.1. 研究の成果（リサーチクエッションの答えをここで盛り込む）

### 5.2. 今後の課題と展望

## 6. 考察

## 7. 謝辞

## 8. 参考文献
