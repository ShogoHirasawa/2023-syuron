# 洪水災害時における避難支援のためのオフライン 3D ハザードマップの開発と評価

### 1.序章

本章では背景、問題意識を明らかにするとともに、目的、研究意義について述べ、本研究の概要と構成について説明する。

### 1.1 本研究の背景

近年、自然災害が多発するなかで、市民の避難を適切にかつ安全に実施することは極めて重要な点である。特に洪水災害においては、2005 年の水防法改正により浸水想定区域の指定を受けた市町村は市民に対して、洪水予測の公表が義務付けられた。また、2005 年から 2009 年に洪水ハザードマップ作成に対する国庫補助制度が策定されたことを契機にハザードマップの普及は進んだ（榎村,2012）。各自治体の Web ページにおいて pdf データでハザードマップの提供、自治体が主導となり各世帯への紙のハザードマップの配布のみならず、国土地理院が国土交通省水管理・国土保全局と協力して提供する「国土交通省ハザードマップポータルサイト」をはじめとした Web 上でインタラクティブに災害情報を伝えるハザードマップも存在する（泉谷,2020）。Web 媒体でハザードマップの閲覧が可能になることで、広域を網羅したハザードマップの作成、各レイヤ情報の表示・非表示が可能となり、多くの情報を盛り込んでもインターフェイスが雑多で見づらくならない、ピンチイン・アウトが可能となり詳細な地図情報を表示できるようになる等の pdf、紙媒体でのハザードマップの表現の限界を克服している。

### 1.2 本研究における問題意識

紙から Web に媒体を変えることでハザードマップの表現方法が豊かになる一方で、洪水被害が発生した際にはインターネットが断絶する事例が報告されている。2020 年 7 月 4 日大雨の影響により熊本県球磨川が氾濫するなどして、死者・行方不明者が 69 人がでる被害が発生した（NHK,2023）。この大雨の影響で、停電、土砂崩れ等が発生し回線が断絶するなどして、22 市町村でインターネットの接続が困難となった（総務省,2020）。また、回線が断絶するといった直接的な被害のみならず、大雨や洪水によって交通インフラが損傷し、インターネットサービスプロバイダー等の通信に関わる事業者の業務が中断されることで、インターネットサービスの提供に支障をきたすことを指摘する研究報告も上がっている（Fekete and Alexander,2019）。加えて、災害時には通信が輻輳し、インターネットに接続が難しくなる状況も発生する（増田,2012）。オフライン環境下では、従来の紙媒体での洪水ハザードマップの利用が想定されるが、避難所や浸水域等の情報を 1 枚の紙に集約しなくてはいけない都合上、インターフェイスが雑多になってしまうことや、配布されて時間が経過することによってハザードマップを紛失してしまう住民が存在するなどの課題がある（方田他,1999）（榎村,2012） 。
洪水ハザードマップの役割の一つに発災時において市民が避難をする際のマニュアルとして機能することが挙げられる（片田他,2004）。「Google Maps」や「Maps．me」等のオフライン環境下であっても、スマートフォンで地図を閲覧できる機能を有したサービスはあるが、浸水深や浸水域の情報、避難所の位置情報、標高情報といった洪水被害の避難の際に避難者が認識するべき情報は有していないため、避難ルートを検討することが難しい。

### 1.3. 本研究の目的と研究意義

以上の背景を踏まえ、本研究の目的は洪水災害発生時のインターネットインフラが機能しない状況において、スマートフォンのブラウザアプリケーションを用いてアクセス可能な 3D 洪水ハザードマップシステムを構築し、避難者に危険地帯を認識させる手法を提案することである。

本研究を通して、洪水災害時のインターネット接続が困難な場合でも、避難者が危険地帯を把握し、適切な避難ルートの検討支援の一助となることを目指す。

### 1.4. 本研究の概要

本研究の目的は洪水災害発生時のインターネットインフラが機能しない状況において、スマートフォンのブラウザアプリケーションを用いてアクセス可能な 3D 洪水ハザードマップシステムを構築し、避難者に危険地帯を認識させる手法を提案することである。本目的を達成するためには、以下の 2 つの条件を満たす必要がある。

- 検証 1:オフライン環境下で適切に Web ハザードマップを避難者に提供できるシステムであること
- 検証 2:作成した洪水ハザードマップを通して避難者が危険地帯を把握できること

検証 1 では、オフライン環境において本システムの稼働可能時間とハザードマップ表示までかかる描画時間を検証した。調査 2 では参加者を集め、作成したハザードマップが洪水災害時における危険地帯の認識につながるかを検証した。検証 1 では避難想定時間を超えるシステム稼働時間が確保できることが確かめられると同時に、適切なスピードで Web ページ描画を表示できることが示された。調査 2 本研究で作成したハザードマップが浸水予想域、低地、傾斜地を利用者に認識させることが可能であることが示された。これにより本目的は達成された。

### 1.5 本研究の構成

本論文の章構成を次に示す。「1-3. 本研究の目的と研究意義 」で述べた目的を達成するために、研究手法を 4 つに分けて説明する。手法の詳細は第 3 章「研究手法」で説明する。

序章では、本研究の背景と問題意識を明らかにし、研究の目的と意義を詳細に述べる。加えて、論文の全体概要と各章の構成について説明する。
第 2 章「関連研究・関連事例」では、洪水災害時におけるインターネット障害の実態と、ハザードマップの媒体の変遷について概説する。その後、オフライン環境で動作する地図システムおよびハザードマップの必要性に触れ、既存のオフライン Web ハザードマップを概説した上で、その限界点を指摘する。さらに、これらの課題を踏まえた上で、本研究の指針を導き出し、リサーチクエスチョンを設定する。
第 3 章「研究手法」においては、本研究で開発したシステムの概要と、その構築に必要とされた 4 つの具体的な実装について説明する。以下の通り、「Raspberry Pi4 を用いた Web ハザードマップ配信システム」、「複数レイヤーによる情報の可視化」、「異なる OS で利用可能なシステムの設計」、「標高情報の 3D 表現」にわけ、実装方法の解説を行う。第 4 章「検証」では、2 つの検証を通じて、システムの耐久性と有効性を評価する。検証 1 では、オフライン環境下でシステムが避難予想時間に対して十分な稼働時間を保つこと、及び適切な読み込みスピードでハザードマップを表示できることを検証する。検証 2 では、参加者を用いて、洪水ハザードマップが浸水予想域、浸水予想深度、低地、傾斜地を適切に認識できるかを検証する。検証結果として、検証 1 ではオフライン環境下におけるシステム稼働時間が内閣府が定義する洪水災害時の避難予想時間を上回ると同時に、Google 社が定義する Web パフォーマンスを測る指標に基づいて、本システムが適切な表示スピードで Web ハザードマップを表示できることが確認された。検証 2 では参加者の 7 割が浸水予想域、浸水予想深度、低地、傾斜地を Web ハザードマップを通じで知覚することができた。
第 5 章「結論」では、検証 1 と検証 2 の結果を基に、洪水災害発生時のオフライン環境下での本システムの機能性と、避難時におけるその有効性について考察する。その上で、研究の限界点を明らかにし、洪水災害時の危険箇所の認識における今後の課題を提示する。そして、本研究が持つ意義と将来の研究方向性について論じる。

## 2. 関連研究・関連事例

本章では、洪水災害時におけるネットワーク障害の実態について、オフライン環境下でのハザードマップに関する既往研究・先行事例を示し、本研究の位置づけを明らかにする。

### 2.1. 洪水被害地域における通信インフラ環境

本節では洪水被害環境下におけるネットワーク障害に関して、どのような事例が発生したのか、また既往研究についてを明らかにする。
2020 年 7 月 4 日に熊本県に豪雨が発生し、死者・行方不明者が 69 人がでる甚大な洪水被害が起きた。岸川（2023）によると、本豪雨の影響により氾濫流と呼ばれる、家屋をも流してしまう大きい威力の濁流が発生するなど、氾濫地域に多くの影響を及ぼし、住居等のインフラを破壊したのみならず、通信インフラにも影響を及ぼしたことが報告されている。総務省（2020）によると、2020 年 7 月 4 日の豪雨による停電、土砂崩れ等によって、被災地域の携帯電話基地局が停波した。最大影響時には NTT ドコモ社 22 市町村、KDDI（au）社 15 市町村、ソフトバンク社 23 市町村で電波障害が発生した。NTT 西日本（2020）によると、インターネットサービス 100 回線でインターネット障害が発生したことが報告された。これらのことから、熊本豪雨では甚大なインターネット障害が発生し、オフライン環境が発生したことがわかる。洪水発生時には停電、土砂崩れ等の影響のみならず、2 次的な影響によってインターネットが断絶または、通信インフラの復旧が長期化する懸念もある。甚大な洪水被害によって、交通インフラ等が機能が停止し、電力や通信インフラの従事者が通常業務を行うためやインフラ復旧のために現場に駆けつけることが難しくなり、定常業務および復旧作業を行うことが難しくなる状況が発生する（Fekete,2019）。このように、洪水被害は直接的または間接的に、インターネットインフラに影響を及ぼすことがある。
近年のスマートフォン普及によって、地図を閲覧する媒体は紙からデジタルへと変遷してきた。日常生活における地図利用において、紙地図の利用は減少傾向にあり、一方でデジタル地図の利用は増加している（株式会社ゼンリン,2018）。また、紙媒体でのハザードマップは紛失しやいことも看過できない問題である（関西大学 社会安全学部,2014）。今後、紙地図の普及が増加する見込みは低い中で、洪水災害時のオフライン環境であっても、使い慣れたデジタル媒体でのアクセス手法を確立することは急務であるといえる。

### 2.2 オフラインで利用可能な地図サービス

インターネットが断絶した際に、紙媒体でのハザードマップはオフライン環境下で利用できる地図ツールとして有効である。ただ紙媒体であるがゆえに広い範囲をカバーしようとすると、紙のサイズを大きくする必要があり、携帯することが難しくなる。実際に自治体が配布するハザードマップのなかには、サイズが大きいため避難時に持ち運ぶには不便なものも存在する（榎村,2012）。ハザードマップは災害時において避難のマニュアルとして活用される。故に、避難の際に帯同が難しい形態であっては本来の目的を遂行できない。2.1 で述べた通り、紙地図の利用は減少していくことが想定されていることから、オフライン環境であってもスマートフォン等のデバイスでデジタル地図を利用できることが求められる。このような背景を踏まえて本節では、既存のオフライン地図についての動向をまとめる。
2005 年にサービスが開始された Google Maps は 2022 年には全世界におけるダウンロード数が 10 億件を超え、現代社会において最も使われている地図サービスである（日経新聞,2022）。Google Maps は Web ブラウザ、スマートフォン、タブレット端末に対応しており、インターネット接続を通じて地図を閲覧することができる。加えて、Google Maps はオフライン環境下でも地図サービスの利用を可能としている。インターネット接続が遅い、利用できない環境を考慮して予め任意のエリアを端末に保存し、オフラインで使用することができる（Google,2023）。オフライン環境でも事前に利用したいエリアを保存しておくことで、ルート検索、ナビゲーション機能、地名検索も行える。ただしオフライン状態であると、公共交通機関、自転車、徒歩の経路を表示することはできず、自動車のルートのみが表示される（図 1）。

（図 1 iOS アプリ版 オフライン時における Google Maps のナビゲーション画面）

Google Maps はオフライン機能を有しているが、あくまでもサブ機能であり通常はインターネット通信を基本とした利用が想定されている。オフラインでの利用に特化したデジタルマップでいうと最も有名なサービスの一つとして MAPS.ME が挙げられる。MAPS.ME は契約する通信キャリアが利用できない地域に旅行する人々をターゲットに利用されており、執筆時で 1 億 4,000 万ダウンロードされている（MAPS.ME,2024）。Google Maps と同様に事前に任意のエリアをダウンロードすることで、オフライン環境下での利用が可能となる。MAPS.ME でも Google Maps と同様にルート検索、ナビゲーション機能、地名検索が行える。加えて、MAPS.ME ではオフライン環境下で自動車、徒歩、自転車に合わせたナビゲーションが行える（図 2）。

（図 2 iOS アプリ版 オフライン時における MAPS.ME のナビゲーション画面）

Google Maps と MAPS.ME ともにインターネット接続が困難な状態であっても、地図の提供が行えるシステムとなっている。これらのサービスはルート検索、ナビゲーション機能、地名検索が行える一方で、洪水災害の避難の際に必要となる浸水域の表示や避難所の表示は行えていない。上記 2 点のサービスは日常的な利用や旅行先での利用を想定しているため、洪水災害のシチュエーションには対応しているとは言い難い。洪水災害発生時においては、浸水域、斜度のある地域、標高が低い地域等の把握が重要となる（日本気象協会,2021）。これを踏まえ次の節では、オフライン環境でかつ災害時の避難に必要となる地図の提供に対して取り組む既往研究を挙げ、オフラインハザードマップの現状を整理する。

### 2.3. オフラインハザードマップの先行研究

2.2 で論じた通り、洪水災害時のインターネット接続が困難な場合においてデジタルなハザードマップへのアクセスを確立することは急務である。本節では災害時のオフライン環境下におけるハザードマップ及びオフライン地図の先行研究を紹介するともに、既往研究における課題を整理する。災害時のオフライン環境でのハザードマップ利用を可能とするものとして、オフライン対応型災害時避難支援システム「あかりマップ」が挙げられる（吉野ほか,2017）。「あかりマップ」は災害時のオフライン環境での稼働に特化した災害時避難支援システムである。このシステムは Android が搭載されたスマートフォン端末でのみ利用することができ、災害が発生する前に利用者が自身の端末に地図情報、避難支援情報をダウンロードすることを想定している（図 3）。

（図 3 あかりマップのシステム図。吉野ほか『災害時支援システム “あかりマップ” の地域住民による防災マップ作成への適用』から引用）

事前にダウンロードされた情報は、災害が発生し通信網が利用不可能になった場合でも、利用者が端末上でアクセスできるようになっている。端末上で表示される情報には、浸水域、避難所の位置、AED（自動体外式除細動器）の設置場所、コンビニエンスストアの場所、自動販売機の設置場所が含まれ、これらの情報はオフライン状態でも参照可能となっている。また、利用者にデバイスの電池残量を意識させるために、画面上部に電池残量を示すバーが設置されている。「あかりマップ」は 2.2 で指摘した課題を克服し、オフライン環境下で激甚災害の避難において重要な情報を提供できる設計になっている。一方で、オフラインで活用可能な洪水ハザードマップとしては 3 つの課題が存在している。1 つ目は特定 オペレーティングシステム（以下 OS という） に依存している点である。「あかりマップ」は Android を搭載したスマートフォンのみで利用することができ、他の OS での利用が不可能な設計になっている。2 点目はユーザーによる事前のダウンロードが必要な点である。2.1 で述べた通り、洪水被害発生時にはインターネットに接続することが難しい場合が生じる。ユーザーが地図情報、避難支援情報を事前にダウンロードしていない場合、「あかりまっぷ」を利用することができない。3 つ目は標高に関する情報が地図上で確認できない点である（図 4）。

（図 4 あかりマップの表示画面。吉野ほか『災害時支援システム “あかりマップ” の地域住民による防災マップ作成への適用』から引用）

「あかりマップ」はベースマップとして OpenStreetMap と Google Maps の地図データを利用している。ベースマップ上には等高線や陰影起伏図といった標高を明示する情報は含まれていない。洪水災害における避難の際には、水の流れが早くなる傾斜地および、アンダーパスや地下街などの低地は危険地帯とされている（日本気象協会,2021; 国土交通省 河川局,2010）。傾斜地、低地を特定するには標高情報が必要となり、標高情報が掲示されていない「あかりマップ」ではオフライン環境で扱える洪水ハザードマップとしての機能を満たしているとは言えない。次節では洪水ハザードマップにおいて、どのように標高情報が提示されているかを整理し、オフライン洪水デジタルハザードマップに適した標高データの可視化方法を検討する。

### 2.4. 洪水ハザードマップにおける標高表記について

洪水ハザードマップは浸水予想域等の危険地帯を表示することで、市民に対し洪水被害の危険性を訴求する役割を持っている。ただし、ハザードマップに表示されている浸水想定はシナリオの一つに過ぎない。これを超える洪水災害があることを避難者は理解し、災害時においてはあらゆるシナリオを想定して避難しなければならない（片田ほか,2004）。水が氾濫した際にどこに水が溜まりやすいのか、どこが傾斜地で水の流れが速くなると想定されるかを地図から把握できれば、避難シナリオの検討が行える。言い換えると、標高情報がないと水の溜まりやすい地域や流水の速度を検討することが難しくなる。従来のハザードマップで表示されるものは浸水深のみである場合が多く，そこから流水を検討することが難しい。故に、避難者は流速については考慮せず，浸水深の浅い地域のみに着目し，それによって安心感を持ってしまう懸念がある（片田ほか,2011）。標高情報が掲載されているものでも、従来のハザードマップでは等高線や高さの数値を直接記入することで、標高情報を提示している（図 n ）（図 n+1）。

（図 n 大阪府 池田市内洪水ハザードマップ（令和 4 年 3 月版））
（図 n+1 文京区水害ハザードマップ 令和 5 年 3 月版）

こういった等高線や標高数値を地図に直接記述する表現は、インターフェイスが煩雑にさせ、他の情報が視認しづらくなる問題がある。関谷・田中（2001）によると、住民からはよりシンプルで視認し易いハザードマップが求められていることが報告されている。これを踏まえ、インターフェイスを煩雑化させない標高表現が求められていることがわかる。本研究では、３ D 表現を用いて標高を表現することで、低地および傾斜地の認識を促す手法を採用した。実装方法や検証については「3. 提案手法」、「4. 実験・検証」で詳しく論じる。

### 2.5. 本研究の指針

本節では、2.1 から 2.4 で整理した既往研究、先行事例を踏まえ課題点を整理する。その後に本研究におけるリサーチクエスチョン、仮説、研究目的をまとめ、研究の指針を定める。

これまで、洪水時に発生するインターネット障害について、オフライン地図の先行事例、オフラインハザードマップの先行研究、ハザードマップにおける標高表示について論じ、課題を整理した。これらを踏まえ本研究におけるシステムに要求されるものは、以下の 3 点にまとめられる。

・利用者がデータの事前ダウンロードを必要としないオフラインハザードマップシステムの構築
・特定 OS への依存がなく、多様な OS に対応したシステム設計
・洪水災害の避難の際に危険地帯を検討する上で必要となる標高情報の表示

上記の課題を踏まえた上で、本研究のリサーチクエスチョンとそれに対する仮説を次のように設定する。

・リサーチクエスチョン:利用者による事前のデータダウンロードを必要とせず、多様な OS に対応し、かつ洪水時の危険地帯を認識を支援する標高情報を効果的に表示できるオフライン洪水ハザードマップシステムは、どのように設計し実装することが可能なのか。

・仮説:Raspberry Pi 4 を活用して、アクセスポイントおよび Web サーバーとして機能する Web 地図システムを開発する。このシステムは、Raspberry Pi 4 に格納されたハザードマップデータを、Wi-Fi 通信を用いてイントラネット環境内で配信できるようにし、オフラインでも Web ベースの洪水ハザードマップを利用者のスマートフォンを介して提供する。また、国土地理院が公開する標高情報と、オープンソースの地図ライブラリである MapLibre GL JS を組み合わせることで、標高情報を 3D 表示し、ユーザーが地形の高低差を直感的に理解できるようにする。このアプローチにより、多様な OS に対応し、洪水時の危険地帯である低地と傾斜地を利用者に認識させるオフラインハザードマップシステムの実現を目指す。

本節で設定したリサーチクエスチョンを検討する具体的な手法については第 3 章「提案手法」にて論じる。

## 3. 提案手法

本章ではまず、本研究で提案するオフラインで稼働する Web 洪水ハザードマップのシステム概要及び運用フローについて述べる。次にシステムを構築するにあたり行った 7 つの実装について論じる。

### 3.1.1 システムの概説

本節では、本システムの概要について論じる。本研究では、低コストでありながら高い汎用性と拡張性を持つマイクロコンピューターである Raspberry Pi4 を用いた地図サーバーの構築を試みた（図 5）。

（図 5 Raspberry Pi4 Model B 本体画像。Raspberry Pi 公式 Web ページ『Buy a Raspberry Pi 4 Model B – Raspberry Pi』から引用。URL: https://www.raspberrypi.com/products/raspberry-pi-4-model-b/ ）

Raspberry Pi は、教育や研究、趣味のプロジェクトなど、多岐にわたる分野で使用されているマイクロコンピューターである（Raspberry Pi Foundation,2021）。各種ソフトウェアを Raspberry Pi4 にダウンロードし、アクセスポイントとして機能させることにより、Raspberry Pi4 を基点としたイントラネットを構築し、オフライン環境下でもスマートフォンを通じてアクセス可能な地図サーバーとしての役割を果たすよう設定した。アクセスポイントとは、ワイヤレスネットワークにおけるデバイス間の通信を仲介する装置のことを指す。Raspberry Pi4 のアクセスポイント化に関する具体的な実装方法は「3.2.1. Raspberry Pi4 を用いた Web ハザードマップ配信システム」で述べる。利用者は Raspberry Pi4 のイントラネットにアクセスすることで、オフライン環境下であってもスマートフォンのブラウザアプリケーション上で洪水ハザードマップを閲覧することができる。また、洪水災害時の避難時における本システムの持ち運び性能を上げるために、3D プリンターを用いてハードカバーを作成した。図 5 の通り、Raspberry Pi4 単体だと基盤がむき出しの状態であり持ち運びには適していない。そこで、Web サイト「きっと何かに役立つでしょ！？」において CC BY-NC-SA 4.0 ライセンス下で stl 形式で公開されている Raspberry Pi4 のケースのデータを活用した（2020,きっと何かに役立つでしょ！？）。上記のデータを用いて 3D プリンタでケースを作成し、Raspberry Pi4 を持ち運びしやすい形にした（図 6）。

（図 6 作成した Raspberry Pi4 のケース）

本節を踏まえて、次節ではシステムの構成について述べ、具体的な利用フローを明らかにする。

### 3.1.2 システムアーキテクチャ

本節ではシステム構成を示した後に、洪水災害時のオフライン環境下で本システムの運用フローについて述べる。まず、本システムのアーキテクチャーを図 7 に示す。

（図 7 システムアーキテクチャー概要）

Raspberry Pi4 を稼働させるため、モバイルバッテリーを用いた給電を想定する。加えて、Raspberry Pi4 の給電ポートがタイプ C であるため、タイプ C で給電可能なモバイルバッテリーを前提とする。給電がされたのち、Raspberry Pi4 のアクセスポイントと Web サーバーが立ち上がり、ハザードマップの配信準備が始まる。アクセスポイントが立ち上がるとスマートフォンの Wi-Fi 選択欄に、Raspberry Pi4 の SSID が表示される（図 8）。本検証においては"dronebird"という SSID 名を設定している。利用者は SSID を選択し、自身のスマートフォンと Raspberry Pi4 を接続する。

（図 8 Wi-Fi の SSID 選択画面。環境: iPhone 13 pro, iOS 16.1.1）

スマートフォンと Raspberry Pi4 の接続が完了した後、Raspberry Pi4 の中に格納されているハザードマップにアクセスするために、Raspberry Pi4 に格納されている HTML ファイルの URL にスマートフォンのブラウザアプリケーションを通じてアクセスする。本検証ではハザードマップの URL を「 http://172.16.0.1 」 とした。SSID の設定及びハザードマップの URL の設定についての詳細は「3.2.1. Raspberry Pi4 を用いた Web ハザードマップ配信システム」にて述べる。URL にアクセスした後、利用者はスマートフォンで洪水ハザードマップを閲覧できるようになる（図 9）。

(図 9 スマートフォンに表示される洪水ハザードマップ)

ハザードマップという性質上、スマートフォンの扱いに慣れている人も慣れていない人も利用することが想定される。スマートフォンを使い慣れていない人々にとっては、スマートフォンの Wi−Fi 選択欄から Raspberry Pi4 の SSID を選択し、後にブラウザ上で URL を打ち込む操作が困難であることが想定される。このことから、Raspberry Pi4 への接続および、ハザードマップの URL の検索を簡略化させた。具体的には、QR コードを作成しそれをスマートフォンのカメラで読み込むことにより、Raspberry Pi4 への接続および、ハザードマップの URL の検索を完了させる実装を行った。これを踏まえ、次に本システムの運用フローについて述べる。まず、本システムの運用フロー図を図 11 に示す。

(図 10 システム運用フロー図)

利用者は Raspberry Pi4 に給電を行ったのち、Raspberry Pi4 の背面にある「① 〇〇」と書かれた QR コードをスマートフォンのカメラでスキャンをする。スキャンを行うことでスマートフォンと Raspberry Pi4 が自動的に接続される（図 12）。

（図 11 Raspberry Pi4 の背面に貼られた 2 種類の QR コード）

次に Raspberry Pi4 の背面にある「② 〇〇」の QR コードを読み込むことで、スマートフォンにインストールされているブラウザアプリケーションが自動で立ち上がり、Raspberry Pi4 に格納されている HTML ファイルの URL に接続され、ハザードマップが閲覧可能となる（図 12）。QR コードを媒介にしたアクセス手法を実装することで、SSID の選択及び URL を打ち込む操作を簡易化させた。QR コードの作成に関する詳細は「3.2.1. Raspberry Pi4 を用いた Web ハザードマップ配信システム」と「3.2.2. 多様な OS に対応したシステム設計」で説明する。次節以降では、具体的な Raspberry Pi4 に施した実装と洪水ハザードマップの作成手法について述べる。

#### 3.2.1. Raspberry Pi4 を用いた Web ハザードマップ配信システム

本節では、Raspberry Pi4 を基調に構築した、オフライン環境下でのハザードマップを配信するシステムについて述べる。はじめに、本システムに利用した Raspberry Pi OS について述べ、最後に Raspberry Pi4 をアクセスポイント化及び Web サーバー化させた実装について論じる。Raspberry Pi4 は OS がインストールされた SD カードを Raspberry Pi4 本体に差し込むことで稼働させることができる。Raspberry Pi の OS は Raspberry Pi 財団が公式でリリースしている「Raspberry Pi Imager」を用いることでインストールすることができる。本研究では、"Raspbian GNU/Linux 11 (bullseye)"を OS として採用した（図 13）。

（図 13 Raspberry Pi4 にインストールした OS の詳細）

次に Raspberry Pi4 のアクセスポイント化と Web サーバー化の実装について述べる。本研究では Raspberry Pi4 をアクセスポイント化させ、イントラネットを構築すると同時に、Raspberry Pi4 内に Web サーバーを立ち上げることで、オフライン環境下でもスマートフォンのブラウザを通じてハザードマップにアクセスできるシステムを構築した。本システムは、Apache2、hostapd、dnsmasq と呼ばれる三つのオープンソースソフトウェアパッケージにより構成される。Apache2 は世界で最も普及している Web サーバーソフトウェアの一つであり、ユーザーリクエストに応じて Web ページや画像、その他のデータを配信する機能を Raspberry Pi4 に提供する。これを Raspberry Pi4 内に構築することで、Web サーバーとして機能させることができる。hostapd は無線 LAN デバイスをアクセスポイントとして機能させるためのソフトウェアであり、Raspberry Pi4 に接続されるスマートフォン等の各デバイスの管理を担う。hostapd インストール後、hostapd 配下（ /etc/hostapd/）に hostapd.conf を作成し、以下の記述を行うことで、Raspberry Pi4 の Wi−Fi 接続時に求められる SSID、パスコード等を設定する（図 14）。また、Wi-Fi に接続するための SSID、パスコードを QR コード化することにより、スマートフォンのカメラで QR コードをスキャンするだけで Raspberry Pi4 に接続が可能となる（図 11）。利用者が仮に SSID、パスコードを忘れる等の事態が発生してもハザードマップにアクセスすることができる設計にした。

（図 14 hostapd.conf に記述した内容）

dnsmasq は、ネットワーク上のデバイスに対して DNS サーバーの役割を果たし、動的に IP アドレスを割り当てる機能を提供するともに、ホストデバイスである Raspberry Pi4 に対して固定 IP を付与する。また、dhcpcd.conf と呼ばれるファイル（/etc/dhcpcd.conf）に対して下記の記述を追記することにより、Raspberry Pi4 に対して固定 IP を付与することができる（図 15）。本検証では固定の IP を 172.16.0.1 に設定した。

（図 15 dhcpcd.conf に記述した内容 ）

固定の IP を設定することにより、洪水ハザードマップにアクセスするための URL が決定する。本検証では「172.16.0.1」を固定 IP と設定したので、「http://172.16.0.1」がハザードマップのURLとなる。これらのパッケージを組み合わせることで、Raspberry Pi4 を基点にしたイントラネットを構築し、オフライン時においてスマートフォンのブラウザアプリケーションを通じて地図データを提供することが可能となった。

#### 3.2.2. 多様な OS に対応したシステム設計

「2.3. オフラインハザードマップの先行研究」で述べたように、既往研究で示されたオフラインデジタルハザードマップにおいては、特定 OS でのみ利用が可能となっている。これにより、特定のプラットフォームやデバイスを利用している人のみがハザードマップにアクセスできる状態になっており、それ対応 OS 以外を使っている場合、ハザードマップにアクセスすることができない。この問題に対処するために、本研究では OS に依存しないブラウザベースの描画方法を採用した。既往研究では、アプリケーションベースでハザードマップを配信していたため、特定のプラットフォームに依存せざるを得ない状態になっていた。ブラウザアプリケーションを通じてハザードマップを描画することで、特定 OS への依存を解消した。本システムは Firefox、Chrome、Safari といった主要なウェブブラウザに対応しており、ユーザーがどのような OS を使用していても、どのようなスマートフォンを持っていても、同様のアクセス体験を提供する（図 16）。ブラウザアプリケーションからの表示方法を実践することで、洪水災害時のオフライン環境において、様々な OS に対応したハザードマップ閲覧手法を確立することができる。

（図 16 各種ブラウザアプリケーションからアクセスしている様子）

利用者はブラウザの検索窓に Raspberry Pi4 から配信されるハザードマップの URL を入力することで、閲覧が可能となる。しかし、本システムの URL はドメイン名ではなく IP アドレスで表記されているため、入力ミス、URL を忘れる等のヒューマンエラーが起きやすいと想定される。このような背景から事前に URL を QR コード化させ、スマートフォンのカメラで読み込むだけでブラウザに URL が自動入力されアクセスできる手法を確立した。「3.1.2 システムアーキテクチャ」でも述べた通り、QR コードによるアクセス手法を確立することで、URL を検索窓に入力してアクセスする手法よりも、ハザードマップ表示へのハードルを低くすることができた。

#### 3.2.3. 洪水ハザードマップの視認性を向上

洪水ハザードマップは平常時に事前に準備しておくことが記載された"防災教育型"と災害時における避難に活用が想定される"避難型"に大別できる（谷垣内,2005）。本システムで表示するハザードマップは"避難型"であり、洪水災害発生時の避難を支援する目的で作成した。利用者に適切な避難を促す使いやすく、見やすいハザードマップを作成するには、文字数はできるだけ少なくシンプルに、避難所等のランドマークを目立たせその他の情報はできるだけ厳選することが求められる（関谷・田中,2008）。上記を踏まえ本システムで表示するハザードマップでは、文字情報の表示と図のシンプル性と重要な情報とそうでないものを考慮したデザインを施行した。本節では、作成したハザードマップデザインの工夫点について論じる。

まず、文字数に関しての工夫点を述べる。文字数を減らすことが見やすいインターフェイスの条件ではあるが、凡例の説明や避難所の名称等においては詳しく書かざるを得ない。これを考慮し、レイヤーの表示・非表示機能を使うことでハザードマップの表記と説明文を共存できるようにした（図 17）。凡例部分では、まず洪水災害時に危険箇所とされる、浸水域、低地、傾斜地を避けるように促す警告文を赤背景に文字色を黄色にすることで目立たせて表示した。下部には浸水深の凡例と避難所の説明を記述した。凡例部は左上に位置する「閉じる/開く」ボタンをクリックすることで、表示と非表示が切り替えられる（図 18）。利用者がハザードマップの浸水域や避難所を閲覧する際には、凡例部分を非表示にすることで、表示情報が煩雑にならなくなる。レイヤー機能を追加し、表示と非表示を任意に切り替えることで文字数とインターフェイスの煩雑性の問題を克服した。

（図 17 ハザードマップの全体図）
（図 18 凡例部分の表示と非表示の切り替え）

次に、洪水ハザードマップに掲載する重要情報を目立たせるために行った工夫について述べる。避難時に重要となる浸水予想域、浸水予想深度及び避難所を目立たせるために、ベースマップの配色に注目した。ベースマップをモノクロを基調とした配色スキームを採用し、浸水情報を青系統、避難所を赤にすることで、ベースマップの視覚的なノイズを減少させ、重要情報な情報のみを際立たせるが可能となった（図 19）。ベースマップの配色を作成するにあたり、（地理院地図 Vector（仮称）,2020）を参考にした。また、避難所のポイントをクリックすることで、避難所名、エレベーターの有無、避難スペースが 1 回にあるか、スロープの有無、点字ブロックの有無、多様性に配慮したトイレの有無、備考を表として確認することができる（図 20）。これらの情報を活用することで、体の不自由な方や高齢の方がいた場合に、避難所のステータスを確認した上で避難先を検討することができる。右上のバツ印をクリックすることで、凡例部分と同様に表示と非表示を切り替えることができる。

（図 20 避難所の詳細表示）

本ハザードマップでは、洪水災害時の避難において重要となる標高の可視化も行った。標高表示は従来の等高線や標高数値を記載する手法ではなく 3D 表現を用いて、低地や高地、傾斜地の視認を促した。次節では標高の 3D 表現の実装理由と実装手法について述べる。

#### 3.1.4. 標高情報の 3D 表現（書き途中。MapLibre GL JS の部分をどうやって肉付けするか）

洪水災害発生時において、水の流れが速くなる斜度のある地域、水が溜まりやすい低地の把握は重要である（日本気象協会,2021）。斜度および低地を把握するには、標高情報が必要となる。従来のハザードマップは等高線を記載することで土地の高さをハザードマップで表現している（国土交通省水管理・国土保全局河川環境課水防企画室, 2019）。一方で等高線はその性質上、大量の線を記載する必要があり、ハザードマップのインターフェイスを煩雑にし、視認性を悪くしている。この課題を踏まえて、本研究では標高情報を 3D 表現することで利用者に低地や高地、傾斜地の訴求を試みた。本節では 3D 標高の可視化表現の概説とその実装方法について論じる。まず、本ハザードマップにおける標高の 3D 表現部分について図 21 で示す。3D 表現を行うことで、高地の部分は盛り上がり、低地の地域は凹んで表示され、立体的に視認できるようになる。また、陰影起伏図を追加し低地と高地に陰影を付けることで、立体感をより引き立てることができる。陰影起伏図とは、太陽の位置を仮定し、地形による陰影を表現することで起伏を視覚化する手法である。標高情報は国土地理院が公開する標高タイル（基盤地図情報数値標高モデル）の DEM10B を利用した。DEM10B とは写真測量によって図化された 1/25,000 地形図の等高線（10m 間隔）から作成され、標高精度が 5m 以内となっているデータのことを指す。同様に、陰影起伏図も国土地理院が公開する陰影起伏図（データソース:標高タイル（基盤地図情報 数値標高モデル））を利用した。上記のデータを踏まえて、オープンソース地図ライブラリ MapLibre GL JS を用いて標高の 3D 表現を行った。

等高線表示とは違い、ハザードマップのインターフェイスを煩雑にすることなく、標高を表現することができた。実際に 3D 表示にすることで洪水災害発生時の危険地帯とされる低地、傾斜地を利用者に訴求できているかについては、「4. 実験・検証」で論じる。

（図 21 標高の 3D 表現）

本研究では MapLibre GL JS を用いた標高情報の 3D 表示を行った。標高情報は洪水被害発生時、地形の標高や傾斜が安全な避難行動に直接関連するため、これらの情報を直感的かつ明瞭に伝える方法の開発が求められている。従来のハザードマップでは、標高情報が等高線等によって表現されることが多いが、この表現方法は一般市民にとって理解しづらいという課題があった。特に、地図上での低地と高地、急傾斜地を直感的に識別することは困難であり、実際の避難行動において適切な情報提供がなされていない問題点がある。本研究では、ウェブベースの地図サーバーに 3D 地図機能を導入し、標高や傾斜の情報を視覚的に捉えやすい形で表現することにより、ユーザーが低地や高地、傾斜地を容易に識別できるようなインターフェイスを開発した。3D 表示により、等高線だけでは把握しづらい地形の起伏や傾斜度を、ユーザーが直感的に理解できるようになる。従来の 2D 地図による表示では実現できなかった、地形の微細な変化を視覚的に捉えることが可能となった。実験当初はヒルシェード（陰影起伏図）機能を利用した高度情報の表示を行っていた。ヒルシェードは、太陽の位置を仮定し、地形による陰影を表現することで起伏を視覚化する手法である。しかし、実証実験および指導教員のフィードバックを通じてヒルシェード（陰影起伏図）に馴染みのないユーザーにとってここから、高さ情報を理解することは難しいことがわかった。このフィードバックを基に、より直感的な理解を促進するため 3D 機能へと移行した。国土地理院が提供する高精度な標高データを利用することで、3D 地図上での地形表現は正確なものとなり、現実の地形に即した情報を表示できるようになった。

## 4. 実験・検証

本研究の目的は洪水被害発生時におけるオフライン環境において、避難者自身のスマートフォンのブラウザアプリケーションを通じて避難ルートを検討するための情報が掲載された洪水ハザードマップを閲覧可能とするシステムの提案をすることである。本目的を達成するためのシステム構築については「3. 提案手法」で述べた。本章では構築したシステムが、洪水災害時を想定したオフライン環境下において、本研究の目的を満たすかどうかを検証する。本検証は以下の 2 つに分けて行われる。

- 検証 1:オフライン環境下で適切に Web ハザードマップを避難者に提供できるシステムであることの検証
- 検証 2:作成した地図デザインを通して避難者が危険地帯を把握できることの検証

検証 1 では、オフライン環境において本システムの稼働可能時間とハザードマップ表示までかかる描画時間を検証する。避難の際にシステムの稼働可能時間が避難想定時間よりも短い、またハザードマップの表示に時間を要するようではシステムの可用性を満たしているとは言えない。このことから、本システムには避難想定時間を上回る稼働時間と、スムーズにハザードマップが閲覧できることが求められる。これを検証するために、内閣府が定義する洪水災害時の避難予想時間を閾値に設定し、これを上回る稼働時間が確保できるかを検証した。次いで、Google 社が定義する Web ページのパフォーマンスを評価する指数を複数用いて本システムにおけるハザードマップの表示スピードを計測した。調査 2 では参加者を集め、標高を 3D 表示し、陰影起伏表現を加えた地図デザインが、洪水災害時の危険地帯である低地と傾斜地を認識させるかを検証した。10 人の参加者に対して、2D の標高表現と陰影起伏を加えたハザードマップと 3D の標高表現と陰影起伏のハザードマップを見比べて 3D 表現の効果を分析した。検証 1 では避難想定時間を超えるシステム稼働時間が確保できることがわかるとともに、Web ページのパフォーマンスを測る指数において、最上位の基準を満たす地図描画が可能であることが計測できた。調査 2 では本地図デザインが洪水災害において危険地帯とされる、低地、傾斜地を認識させることが可能であることが示された。本章では検証 1 を「4.1. システム稼働時間とページ表示スピードの計測」で、検証 2 を「4.2. 3D 標高表現に関するユーザビリティ評価」で論じる。

### 4.1. システム稼働時間とページ表示スピードの計測

本節ではシステムの可用性を確かめるため、システムの稼働可能時間の計測と、ハザードマップの描画スピードの測定を行う。

#### 4.1.2 システム稼働時間の計測

本システムが洪水災害時の避難において十分な稼働時間を確保できるかを検証する。内閣府防災情報（2018）が定義する洪水災害時の避難に要する想定時間を閾値に設定し、本システムがそれを超える稼働が可能かどうかを確かめる。内閣府防災情報（2018）では荒川と江戸川による浸水被害のシュミレーションを行い、江東 5 区（墨田区・江東区・足立区・葛飾区・江戸川区）における避難者を 178 万人と定義し、避難者の 9 割が避難完了する時間を約 17 時間と推定した。本検証ではこれを閾値に設定し、システムがこの閾値を超えて稼働可能かを検証する。はじめに、本検証における概略図を示す（図 22）。本システムはモバイルバッテリーを用いた給電を想定する。加えて、Raspberry Pi4 の給電ポートがタイプ C であるため、タイプ C で給電可能なモバイルバッテリーを用いた稼働を前提とする。モバイルバッテリーと Raspberry Pi4 の間に電圧・電流測定器を設置し消費電力を計測した。なお計測器には、ルートアール社の RT-TC5VABK を用いた。

（図 22 　システム消費電力の計測の構成図）

本検証ではシステムに対し、24 時間の通電を行い消費電力を計算し、412mwh という数値がでた（図 23）。一般的に販売されているモバイルバッテリーにはリチウムイオン電池が使われており、その定格電圧は一般的に 3.7V であることから、この数値をモバイルバッテリーの電圧と定義する。これを踏まえてシステムの稼働時間を計算すると、5000mA のモバイルバッテリーでは約 2694 分（約 44.9 時間）、10000mA では約 5388 分（約 89.8 時間）稼働できることがわかる。以上により、本システムは避難時において、十分な稼働時間を確保できるものであるということが確かめられた。

（図 23 消費電力の計測）

#### 4.1.2. ハザードマップの描画スピードの計測

本検証ではシステムから配信されるハザードマップの表示スピードの評価を行う。検証を行う上で Google 社が定義する Web パフォーマンスを計測する、First Contentful Paint（FCP）、Largest Contentful Paint（LCP）、Time to Interactive（TTI）と呼ばれる 3 つの指標を用いる（図 24）。FCP は、ページの読み込みが始まってからテキストや画像などのコンテンツが画面上に初めて表示されるまでの時間を測定し評価する尺度である。1.8 秒未満が良好、1.8 秒以上 3.0 秒未満が要改善、3.0 秒以上が不良と定義される（Walton,2023）。LCP とはウェブページの読み込み性能を測定する尺度で、ページが読み込まれてからサイトのメインビジュアルやテキストブロックが画面に表示されるまでの時間を示す。LCP を用いることで、ユーザーがページの主要な内容をどの程度の速度で見ることができるかを示し、ユーザー体験の質を評価することができる。2.5 秒未満は良好、4 秒以下は要改善、4 秒以上は不良と定義される（Walton・Pollard,2023）。TTI とは Web ページが最初にロードされた後、ページが完全にインタラクティブになるまでの時間を計測する指標である（Walton,2023）。これは、ページが表示されてからユーザーが完全にページをインタラクティブに操作できるようになるまでの時間を示す。0 秒から 3.9 秒未満が高速とされ、3.9 秒以上 7.3 秒未満が中速、7.3 秒以上は低速と定義される。

（図 24 First Contentful Paint（FCP）、Largest Contentful Paint（LCP）、Time to Interactive（TTI）について）

本検証を行うにあたり、図 25 の環境で計測を行った。Raspberry Pi4 に給電を行い、イントラネット内で 3 台のスマートフォンと 1 台のラップトップ PC にハザードマップを配信している状態での計測を行った。なお、Raspberry Pi4 と 4 台のデバイスは 1.7m の距離を保った状態で計測した。本計測は、夫婦と未婚の子供 2 人の核家族世帯が避難する場面で、計 4 台デバイスで接続することを想定している。計測はラップトップ PC（MacBook Pro 13-inch, M1, 2020 チップ Apple M1 メモリ 16 GB macOS Ventura 13.3.1 ）上で Google Chrome（119.0.6045.199（Official Build） （arm64））の Performance Insights の機能を用いて計測した。Performance Insights はネットワークの接続状況と利用する CPU の性能を予め設定した上で FCP、LCP、TTI の計測を行える。これらを設定することにより、任意の接続環境及び CPU スペックを指定して値を出すことができる。本検証では、Raspberry Pi 4 のネットワークを利用する際に特に設定を加える必要はないため、ネットワークスロットリングは Nothing で設定した。次いで、CPU ストロットリングの値を 4 x slowdown に設定した。これは計測器であるラップトップ PC が保有する CPU の 1/4 のスペックで計測することを意味する。一般的にスマートフォンの CPU はラップトップ PC より性能が劣ることが多いため、本検証では 1/4 のスペックを設定した（図 26）

（図 25 検証環境の概略図）
（図 26 ネットワークスロットリングと CPU ストロットリングの設定）

上記の条件で計測を行った結果、FCP 0.53 秒、LCP 0.53 秒、TTI 1.66 秒の値を示した（図 27）。これは各種指標において最上位のステータスに分類される値であり、オフライン環境下でも高い Web パフォーマンスでハザードマップを配信できることが確かめられた。このことから、本システムはオフライン環境下であっても、十分な速度でハザードマップを表示できることが示せた。

### 4.2. 3D 標高表現に関するユーザビリティ評価

本節では作成した標高を 3D 表示し、陰影起伏表現を加えた地図デザインが、危険地帯である低地と傾斜地を利用者に認識させることができるのかを検証する。本節の構成は、はじめに検証方法について述べ、次いで参加者の属性について説明し、最後に検証結果を論じる。

#### 4.3.1. 検証方法

本検証はオンラインビデオツールを用いて 10 人の参加者に対して、2D の標高表現と陰影起伏を加えたハザードマップと 3D の標高表現と陰影起伏のハザードマップを見比べて 3D 表現が危険地帯の認識に対してどのような効果があるかを確かめた（図 27）（図 28）。参加者は自身のスマートフォンでハザードマップにアクセスし、はじめに 2D のハザードマップを閲覧し、自身が徒歩で避難すると想定した時に、どこが危険地帯であると感じる場所を複数個抽出する。次に 3D 表現を用いたハザードマップを閲覧し、同様に危険地帯であると思われる場所を指摘する。ハザードマップを閲覧する時間は最長で 5 分までとした。2D と 3D のハザードマップを閲覧した上で、危険地帯の認識がどう変化したのか、変化しない場合はなぜ変化しなかったのかをインタビュー形式でヒアリングをした。インタビューを終えたのち、図 29 と表 1 で示す質問事項にオンラインフォームを通じて入力してもらい、結果を集計した。

（図 27 検証フロー）
（図 28 参加者が閲覧した 2D マップと 3D マップ）
（図 29 質問フォーム）
（表 1 質問事項）

#### 4.3.2 被験者の属性

本検証では、参加者が日常的にどの程度デジタル地図を利用するか、ハザードマップを閲覧するかを集計した。図 28 と図 29 にその結果を示す。参加者の〇〇%はデジタル地図を利用する一方で〇〇%はほとんど使わない結果となった。ほとんど使わないと回答した参加者を対象に、なぜデジタルマップを利用しないかを質問したところ、日頃同じ道しか通らないので旅行の時にしか地図アプリを開かないとの回答を得た（表 2）。また、ハザードマップの閲覧頻度に関しては、全ての参加者がほとんど利用しないと回答した。なぜ、ハザードマップを日常的に閲覧しないかを質問に対しての回答を表 3 に示す。
（図 28 どのような頻度でデジタル地図を利用しますか？に対する回答）
（図 29 どのような頻度でハザードマップを閲覧しますか？に対する回答）
（表 2 デジタル地図をほとんど利用しないと回答した参加者の回答）  
<img width="600" alt="image" src="https://github.com/ShogoHirasawa/2023-syuron/assets/29940264/f86b2475-6a8e-4238-bac5-af4a5ce5973c">
（表 3 ハザードマップをほとんど利用しないと回答した参加者の回答）

年に 1 回定期的にハザードマップを閲覧する参加者が 1 名おり、回答があったそれ以外の参加者は、1 度もしくは 1 度もハザードマップを閲覧したことがない結果となった。このことから、デジタルマップを利用する機会はあるが、ハザードマップの利用は日常的にほとんどない層が大部分を占める検証となった。

#### 4.3.2. 調査結果

本節では、文京区周辺の 2D の標高表現と陰影起伏を加えたハザードマップと同じく文京区周辺の 3D の標高表現と陰影起伏のハザードマップを見比べて得られた参加者の回答を示す。はじめに、2D の標高表現と陰影起伏を加えたハザードマップを閲覧してどの地域を危険だと認識したかを示し、その後 3D ハザードマップではどこを認識したかを述べる。参加者が危険地帯を指摘する際には、具体的に地名や町丁目名といった特定の箇所を指定する回答のみならず、浸水域全般といった広い地域を指す回答も許容するものとした。最後に、2D と 3D を見比べた上危険地帯の認識にどのような影響があったについての参加者の回答をまとめる。まず、2D の標高表現と陰影起伏を加えたハザードマップを閲覧した上で得られた回答を表 4 に示す。結果を見ると、参加者全員が浸水予想域全般を危険地帯と認識していた。浸水予想域に囲まれている地域や浸水予想域の中でも河川に近い土地を危険地帯だと認識する参加者もいた。一方で、低地と傾斜地を危険地帯だと認識している回答は 1 名のみであった。  
<img width="600" alt="image" src="https://github.com/ShogoHirasawa/2023-syuron/assets/29940264/ae0aa8fe-51ab-4c74-81a5-a5797b2ec04d">  
（表 4 2D マップを見た上でどこを危険地帯だと感じたかについての回答）

次に、3D の標高表現を用いたハザードマップを閲覧した上で危険地帯と感じた場所の回答を表５に示す。2D の標高表現と同様に 3D の標高表現のハザードマップでも参加者全員が浸水予想域全般を危険地帯と認識していた。加えて、3D の標高表現を用いたハザードマップでは、70%の参加者が標高の高低差がある箇所全般を危険箇所であると認識した。2D 表現では見られなかった、傾斜に囲まれた地帯や斜度のある地域を危険地帯と認識する回答も見られた。  
<img width="600" alt="image" src="https://github.com/ShogoHirasawa/2023-syuron/assets/29940264/a0d49b7b-e928-4316-a68d-c33483fee21e">  
（表 5 3D マップを見た上でどこを危険地帯だと感じたかについての回答）

最後に、2D 表現と 3D 表現で危険地帯の認識にどのような変化があったかについての回答についてまとめる。回答結果を表 6 にまとめる。2D 表現と 3D 表現を比較した時に、参加者の 70%は 3D 表現があることで高低差を危険地帯と認識し、50%が傾斜地を危険地帯と認識できたと回答した。また、3D 表現があることで、水の流れる方向や流速のイメージをすることができたという意見も見られた。一方で 3D 表現の地図を用いても、30%の参加者は高低差および傾斜地を認識できなかったと回答した。  
<img width="600" alt="image" src="https://github.com/ShogoHirasawa/2023-syuron/assets/29940264/41b6532c-26b9-4571-bb0e-5506651ffabb">  
（表 6 2D マップと 3D マップを見比べた上で、危険地帯の認識にどのような変化があったかについての回答）

## 5. 結論

本章では初めに、第 4 章「実験・検証」における成果を基に、洪水災害発生時のオフライン状況における当該システムの有効性に関して総括する。その後、研究目的に対しての結論を述べる。続いて、本研究の学術的寄与に関する議論を展開し、システムの潜在的課題を指摘する。最終的には、研究の制約点を明らかにし、将来的な研究方向性について検討を加える。

#### 5.1. 洪水災害時のオフライン環境における本システムの可用性について

本研究の目的は、洪水被害発生時に通信インフラがダウンした状況でも、スマートフォンのブラウザアプリケーションを通じて避難ルートを検討するための情報が掲載された洪水ハザードマップを閲覧可能とするシステムの提案することであった。そのために、Raspberry Pi4 を基盤とした洪水ハザードマップ配信システムを構築するとともに、洪水災害時の危険地帯である低地と傾斜地の認識を可能にするため、標高の 3D 表現と陰影起伏を加えた地図デザインを設計した。本システムが洪水災害時のネットワーク障害が発生している際に、求められる機能を満たしているかを確かめるため、検証 1 と検証 2 を行った。その結果、本システム次の 3 つの機能性を有していることが示された。

- 稼働時間について
  本システムの稼働可能時間は 5000mA のモバイルバッテリーでは約 2694 分（約 44.9 時間）、10000mA では約 5388 分（約 89.8 時間）である。これは内閣府防災情報（2018）が定義する洪水災害時の避難に要する想定時間を超える稼働時間であり、避難にかかる時間以上に稼働することを示せるものである。

- ページの表示スピードについて
  Web ページのパフォーマンスを評価する First Contentful Paint（FCP）、Largest Contentful Paint（LCP）、Time to Interactive（TTI）と呼ばれる 3 つの指標において、本システムは全ての指標において最高位の基準を満たす数値を示せた。よって、オフライン環境下であっても十分な速度でハザードマップを描画できることを確認できた。

- ハザードマップにおける低地と傾斜地の認識ついて
  ハザードマップにおける低地と傾斜地の認識を可能にするため、標高の３ D 表現と陰影起伏を加えた地図デザインを設計した。本地図デザインを施すことで、2D では低地と傾斜地の認識が 10%だったのに対し、3D の表現を加えることにより 70%まで向上させることができた。このことから、低地と傾斜地の認識させることにおいて、3D 表現が有効であることが確かめられた。

#### 5.2. リサーチクエスチョンと仮説に対する結論

前述のシステムの可用性に関する三つの検証結果を基に、本研究のリサーチクエスチョンへの回答を導き出す。第 2 章で概説した関連研究と事例を踏まえ、設定されたリサーチクエスチョンと仮説は以下の通りである。

・リサーチクエスチョン:利用者による事前のデータダウンロードを必要とせず、多様な OS に対応し、かつ洪水時の危険地帯の認識を支援する標高情報を効果的に表示できるオフライン洪水ハザードマップシステムは、どのように設計し実装することが可能なのか。

・仮説:Raspberry Pi 4 を活用して、アクセスポイントおよび Web サーバーとして機能する Web 地図システムを開発する。このシステムは、Raspberry Pi 4 に格納されたハザードマップデータを、Wi-Fi 通信を用いてイントラネット環境内で配信できるようにし、オフラインでも Web ベースの洪水ハザードマップを利用者のスマートフォンを介して提供する。また、国土地理院が公開する標高情報と、オープンソースの地図ライブラリである MapLibre GL JS を組み合わせることで、標高情報を 3D 表示し、ユーザーが地形の高低差を直感的に理解できるようにする。このアプローチにより、多様な OS に対応し、洪水時の危険地帯である低地と傾斜地を利用者に認識させるオフラインハザードマップシステムの実現を目指す。

スマートフォンのブラウザアプリケーション経由でハザードマップを表示させることで、特定 OS に依存しない表示方法を確立できた。また、MapLibre GL JS を用いて標高情報の 3D 表示と陰影起伏をオーバーレイした地図デザインを設計することで、地形の高低差が際立ち、低地と傾斜地を利用者に認識させることが可能となった。加えて、高低差が可視化されることで、利用者に流水の速度や流れる方向もイメージさせることができる可能性を模索することができた。一方で、本検証では参加者の 3 割は 3D 表現を用いても、土地の高低差の認識することができなかった。そのため今後、標高を認識させるための地図デザインについて再考し、より確実に低地と傾斜地を認識させるための手法について追加検証する必要があるという研究課題が示唆された。

#### 5.5 本研究の意義

#### 5.6 本研究の限界

## 6. 謝辞

本研究の遂行にあたり、多くの方々にご指導ご鞭撻を賜りました。

東京大学大学院学際情報学環の高木聡一郎教授には、継続的かつ詳細な指導を賜り、その深い見識と経験から多大な恩恵を受けましたことを、心より感謝申し上げます。副指導教官として東京大学大学院学際情報学環の渡邉英徳教授には、研究に関する的確なアドバイスと温かい励ましを賜り、特に国際カンファレンス FOSS4G での発表を実現するにあたり、貴重な支援をいただきました。この場を借りて深く感謝の意を表します。
同様に、青山学院大学地球社会共生学部の古橋大地教授には、技術的な指導と貴重なアドバイスを賜り、学問的成長に大きく貢献していただきました。高木聡一郎研究室及び渡邉英徳研究室の全てのメンバーに対しても、日常的な意見交換と研究に対する励ましに感謝を捧げます。
最後になりますが、修士課程の学業と職務を両立させることを支援してくださった株式会社ユーカリヤの関係者に深く感謝申し上げます。これら全ての方々のご支援なくして、本研究の完成はあり得ませんでした。心より感謝いたします。

## 8. 参考文献
